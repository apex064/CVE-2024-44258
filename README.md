# CVE-2024-44258: Symlink Vulnerability in ManagedConfiguration Framework

## Summary

**CVE-2024-44258** highlights a symlink vulnerability within the **ManagedConfiguration framework** and the **profiled daemon** in Apple devices. When restoring a crafted backup, the migration process fails to validate whether the destination folder is a symbolic link (symlink), leading to unauthorized file migration into restricted areas.

---

## CVE ID  

**CVE-2024-44258** has been assigned to this issue. CVEs are unique identifiers for publicly disclosed security vulnerabilities.

- **Impact:** Restoring a maliciously crafted backup file may lead to modification of protected system files.  
- **Description:** This issue has been addressed with improved handling of symlinks in the affected components.  

For more information, please refer to Appleâ€™s official support pages:  
- [support.apple.com/en-us/121569](https://support.apple.com/en-us/121569)  
- [support.apple.com/en-us/121566](https://support.apple.com/en-us/121566)  
- [support.apple.com/en-us/121563](https://support.apple.com/en-us/121563)  

---

## Details

### Affected Components:
- **ManagedConfiguration framework**  
- **profiled daemon**

### Impact:
The vulnerability allows attackers to leverage symbolic links during a backup restore to bypass folder restrictions, writing files into sandboxed or protected areas. This flaw can potentially allow unauthorized data access, privilege escalation, or exploitation of other services dependent on the modified configuration.

---

## Steps to Reproduce

1. **Create a crafted backup**  
   - Create a symlink from:  
     `/private/var/containers/Shared/SystemGroup/systemgroup.com.apple.configurationprofiles/Library/`  
     to a sandboxed folder using domain:  
     ```shell
     SysSharedContainerDomain-systemgroup.com.apple.configurationprofiles
     ```

2. **Add desired files**  
   - Insert files and folders into:  
     `/private/var/mobile/Library/ConfigurationProfiles`  
     using the **HomeDomain**.

3. **Restore the crafted backup**  
   - Restore the backup to any iPhone, iPod, or iPad device.

4. **Reboot the device**  
   - After reboot, inspect the contents of the restricted area. You will find the files/folder migrated to a previously protected location.

---

## Expected vs. Actual Results

- **Expected:**  
  `/private/var/mobile/Library/ConfigurationProfiles` should migrate to:  
  `/private/var/containers/Shared/SystemGroup/systemgroup.com.apple.configurationprofiles/Library/`

- **Actual:**  
  Due to the crafted symlink, the files are migrated into a restricted folder that can contain sensitive or protected data.

---

## Exploit Status

This vulnerability has been observed **in the wild for several months**, indicating its active exploitation.

---

## Patched Area

TODO

---

## PoC (Proof of Concept)

You can find the crafted backup [attached here] or reproduce it using the following procedure:

1. Create a symlink from the desired destination to a sandboxed folder.
2. Add desired content into the backup via the `HomeDomain`.
3. Restore the backup and reboot the device.

---

## Disclosure Timeline

- **Initial Report to Apple:** [10/07/2024]
- **CVE Assigned:** CVE-2024-44258  
- **Public Disclosure:** [01/11/2024]

---

## Acknowledgments

Special thanks to the Apple security team for their swift response and collaboration.
Vulnerability discovered by Hichem Maloufi & Christian Mina

---

## License

This repository is licensed under the MIT License. See `LICENSE` for more information.

